<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>navbar</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<div class="nav" th:fragment="navbar">
    <a href="/"><span class="logo">SOLSITE</span></a>
    <span>
    <a href="/write" class="menu">์ํ ๋ฑ๋ก</a>
    <a href="/my-page" class="menu">๋ง์ดํ์ด์ง</a>
    <a href="/join" class="menu">ํ์๊ฐ์</a>
    <span th:if="${#authorization.expression('hasAuthority(''ADMIN'')')}">
         <a href="/admin" class="menu">ADMIN</a>
    </span>
    </span>
    <span th:unless="${#authorization.expression('isAuthenticated()')}">
        <a href="/login" class="menu">๋ก๊ทธ์ธ</a>
    </span>
    <span th:if="${#authorization.expression('isAuthenticated()')}" class="login-user">

        <form th:action="@{/logout}" method="post">
            <button type="submit" class="logout-btn">๋ก๊ทธ์์</button>
        </form>
<!--                <span th:text="'๐ '+${#authentication.principal.displayName}+'๋'" class="login-user-name"/>-->
          <span class="login-user-name"></span>
        </span>
</div>
<script th:inline="javascript">
    /*<![CDATA[*/
    function updateNavbarDisplayName() {
        // Ajax๋ฅผ ์ฌ์ฉํ์ฌ ์๋ฒ์์ ์๋ก์ด ๋๋ค์์ ๊ฐ์ธ์ด
        $.get("/get-username", function(data) {
            // ๊ฐ์ธ์จ ๋๋ค์์ ๋ค๋ธ๋ฐ์ ๋ฐ์
            var displayName = data;
            if (displayName) {
                $('.login-user-name').text('๐ ' + displayName + '๋');
                console.log(displayName);
            }
        });
    }
    console.log(displayName);

    // ํ์ด์ง๊ฐ ๋ก๋๋ ๋์ ๋๋ค์์ด ์๋ฐ์ดํธ๋ ๋ ํธ์ถ
    $(document).ready(function() {
        updateNavbarDisplayName();
    });
    /*]]>*/
</script>
</body>
</html>
