<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>mypage</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="/main.css" rel="stylesheet">
    <style>
        @keyframes fadeOut {
         from {
             opacity: 1;
         }
         to {
             opacity: 0;
         }
     }

     #successMessage {
         animation: fadeOut 1s ease-out 2s forwards;
     }
    </style>
</head>
<body>
<div th:replace="~{ nav.html::navbar }"></div>
<!--<div sec:authentication="principal"></div>-->
<!--<div sec:authentication="principal.username"></div>-->
<!--<div sec:authorize="hasAuthority('ì¼ë°˜ìœ ì €')">-->
<!--<div sec:authorize="isAnonymous()">-->
<!--    <h3>ì´ ìœ ì €ëŠ” ì¼ë°˜ ìœ ì € ê¶Œí•œì…ë‹ˆë‹¤.</h3>-->
<!--</div>-->

<div class="container my-area">
    <h2><i class='bx bxs-user-circle my-con' ></i> My Page</h2>
    <p>ì•„ì´ë”” <span class="bold-text" th:text="${username}"></span></p>
    <p>ë‹‰ë„¤ì„ <span class="bold-text" th:text="${displayName}"></span></p>
    <button class="accordion">ì£¼ë¬¸ ë‚´ì—­</button>
    <div class="panel">
        <p th:if="${!sales.isEmpty()}">
            <span th:each="sale : ${sales}">
                ì£¼ë¬¸ ë²ˆí˜¸: <span th:text="${sale.id}"></span> ìƒí’ˆëª…: <span th:text="${sale.itemName}"></span> ê°€ê²©: <span th:text="${sale.price}+'ì›'"></span><br>
            </span>
        </p>
        <p th:if="${sales.isEmpty()}">ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>
    <button class="accordion">ë‚´ê°€ ì‘ì„±í•œ ë¦¬ë·°</button>
    <div class="panel">
        <p th:if="${!reviews.isEmpty()}">
            <span th:each="review : ${reviews}">
                ë¦¬ë·° ë²ˆí˜¸: <span th:text="${review.id}"></span> ë‚´ìš©: <span th:text="${review.content}"></span><br>
            </span>
        </p>
        <p th:if="${reviews.isEmpty()}">ì‘ì„±í•œ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>
    <button class="accordion">ë‹‰ë„¤ì„ ìˆ˜ì •í•˜ê¸°</button>
    <div class="panel">
        <form action="/update-nickname" method="post" onsubmit="return validateDisplayName()">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <label for="displayName">ë‹‰ë„¤ì„</label>
            <input type="text" id="displayName" name="displayName" placeholder="ìˆ˜ì •í•  ë‹‰ë„¤ì„" th:value="${displayName}">
            <input type="submit" class="btn btn-sm btn-outline-secondary" value="ìˆ˜ì •í•˜ê¸°">
        </form>
    </div>
    <button class="accordion">ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •</button>
    <div class="panel">
        <form action="/update-password" method="post" onsubmit="return validatePassword()">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <label for="newPassword">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
            <input type="password" id="newPassword" name="password" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸">
            <label for="confirmPassword">ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥</label>
            <input type="password" id="confirmPassword"  placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥">
            <input type="submit" class="btn btn-sm btn-outline-secondary" value="ë³€ê²½í•˜ê¸°">
        </form>
    </div>

</div>

<script th:inline="javascript">
    /*<![CDATA[*/
    // ì•Œë¦¼ ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì™€ì„œ í‘œì‹œ
    var message = /*[[${message}]]*/ null;
    console.log("Message:", message);
    if (message) {
        alert(message);
    }
    /*]]>*/
</script>

<script>
  var acc = document.getElementsByClassName("accordion");
  var i;

  for (i = 0; i < acc.length; i++) {
      acc[i].addEventListener("click", function() {
          this.classList.toggle("active");
          var panel = this.nextElementSibling;
          if (panel.style.display === "block") {
              panel.style.display = "none";
          } else {
              panel.style.display = "block";
          }
      });
  }

function validateDisplayName() {
      var displayName = document.getElementById("displayName").value;
      var displayNamePattern = /^[ê°€-í£a-zA-Z]*$/;

      // ê³µë°± ë˜ëŠ” ìŠ¤í˜ì´ìŠ¤ë°” ì²´í¬
      if (displayName.trim() === "") {
          alert("ë‹‰ë„¤ì„ì— ê³µë°± ë˜ëŠ” ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
          document.getElementById("displayName").focus();
          return false;
      }

      // í•œê¸€ ë˜ëŠ” ì•ŒíŒŒë²³ ë¬¸ì ì²´í¬
      if (!displayNamePattern.test(displayName)) {
          alert("ë‹‰ë„¤ì„ì€ í•œê¸€ ë˜ëŠ” ì•ŒíŒŒë²³ ë¬¸ìë¡œë§Œ ì´ë£¨ì–´ì ¸ì•¼ í•©ë‹ˆë‹¤.");
          document.getElementById("displayName").focus();
          return false;
      }
      return true; // ìœ íš¨ì„± ê²€ì¦ í†µê³¼
    sessionStorage.updateItem('displayName', displayName);

  }

window.onload = function() {
    // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë‹‰ë„¤ì„ì„ ê°€ì ¸ì™€ì„œ ë„¤ë¹„ê²Œì´ì…˜ë°”ì— í‘œì‹œ
    var displayName = sessionStorage.getItem('displayName');
    if (displayName) {
        var loginUserName = document.querySelector('.login-user-name');
        loginUserName.textContent = 'ğŸƒ ' + displayName + 'ë‹˜';
        console.log(loginUserName);
    }
};



function validatePassword() {
      var newPassword = document.getElementById("newPassword").value;
      var confirmPassword = document.getElementById("confirmPassword").value;
      var passwordPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;

      // ìƒˆ ë¹„ë°€ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì¦
      if (!passwordPattern.test(newPassword)) {
          alert("ë¹„ë°€ë²ˆí˜¸ëŠ” ëŒ€ì†Œë¬¸ìë¥¼ í¬í•¨í•œ ì•ŒíŒŒë²³ê³¼ ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•˜ì—¬ 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
          document.getElementById("newPassword").focus();
          return false;
      }

      // ìƒˆ ë¹„ë°€ë²ˆí˜¸ì™€ ì¬ì…ë ¥ ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ ì—¬ë¶€ í™•ì¸
      if (newPassword !== confirmPassword) {
          alert("ìƒˆ ë¹„ë°€ë²ˆí˜¸ì™€ ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
          document.getElementById("confirmPassword").focus();
          return false;
      }

      return true; // ìœ íš¨ì„± ê²€ì¦ í†µê³¼
  }


</script>
</body>
</html>